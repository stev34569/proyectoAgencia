@model proyectoAgencia.Entities.UsuarioEnt
@{
    ViewData["Title"] = "Registro";
    //Descomentar esto
    Layout = null;

}


<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="~/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="~/assets/img/favicon.png">
    <title>
        Argon Dashboard 2 by Creative Tim
    </title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="~/assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="~/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link href="~/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="~/assets/css/argon-dashboard.css?v=2.0.4" rel="stylesheet" />
</head>

<body class="">
    
    <main class="main-content  mt-0">
        <div class="page-header align-items-start min-vh-50 pt-5 pb-11 m-3 border-radius-lg" style="background-image: url('https://raw.githubusercontent.com/creativetimofficial/public-assets/master/argon-dashboard-pro/assets/img/signup-cover.jpg'); background-position: top;">
            <span class="mask bg-gradient-dark opacity-6"></span>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-5 text-center mx-auto">
                        <h1 class="text-white mb-2 mt-5">Bienvenido!</h1>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row mt-lg-n10 mt-md-n11 mt-n10 justify-content-center">
                <div class="col-xl-4 col-lg-5 col-md-7 mx-auto">
                    <div class="card z-index-0">
                        <div class="card-header text-center pt-4">
                            <h5>Registro</h5>
                        </div>
                        <div class="row px-xl-5 px-sm-4 px-3">
                
                        </div>
                        <div class="card-body">

                            @using (Html.BeginForm("RegistrarUsuario", "Home", FormMethod.Post, new { @class = "text-start" }))
                            {
                                <div class="input-group input-group-outline mb-3">
                                    @Html.TextBoxFor(x => x.Identificacion, new { @class="form-control", @type="text", @placeholder="Identificación", @onchange = "obtenerNombre()"  })
                                </div>
                                <div class="input-group input-group-outline mb-3">
                                    @Html.TextBoxFor(x => x.Nombre, new { @class="form-control", @type="text", @placeholder="Nombre",
                                @readonly = "readonly" ,@style = "background-color: #f2f2f2; color: #333; pointer-events: none;"})
                                </div>
                                <div class="input-group input-group-outline mb-3">
                                    @Html.TextBoxFor(x => x.CorreoElectronico, new { @class="form-control", @placeholder="Correo Electrónico" })
                                </div>
                                <div class="input-group input-group-outline mb-3">
                                    @Html.TextBoxFor(x => x.Contrasenna, new { @class="form-control", @type="password", @placeholder="Contraseña" })
                                </div>
                                <div class="col-sm-3">
                                    <!-- La llave del sitio que dan en la página de captcha de Google -->
                                    <div class="g-recaptcha" data-sitekey="6Le9rVonAAAAAN1DmUX2HwlVc6hHOZGxNT-4sAy6"></div>
                                </div>
                                <!-- Para poder hacer la validación de que si el captcha ya fue realizado, obtener los datos -->
                                <input type="hidden" id="recaptchaValue" name="recaptchaValue" />

                                @if (ViewBag.Mensaje != null)
                                {
                                    <div style="text-align:center" class="alert alert-light" role="alert">
                                        @ViewBag.Mensaje
                                    </div>
                                }

                                <div class="text-center">
                                    <button type="submit" class="btn btn-lg bg-gradient-primary btn-lg w-100 mt-4 mb-0" onclick="onSubmit()">Registrarse</button>
                                </div>
                                <p class="mt-4 text-sm text-center">
                                    ¿tienes una cuenta?
                                    <a href="@Url.Action("Index","Home")" class="text-primary text-gradient font-weight-bold">Ir al Inicio</a>
                                </p>
                            }
                            </>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- -------- START FOOTER 3 w/ COMPANY DESCRIPTION WITH LINKS & SOCIAL ICONS & COPYRIGHT ------- -->
    <footer class="probootstrap_section probootstrap-border-top" style="padding-top: 10px; padding-bottom: 10px; text-align: center;">
        <div class="container">
            <div class="row pt-3">
                <div class="col-md-12" style="font-size: 12px; margin-top: 50px;">
                    <p class="probootstrap_font-14" style="line-height: 1;">
                        &copy; 2022. Derechos Reservados. <br> Programación Avanzada
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- -------- END FOOTER 3 w/ COMPANY DESCRIPTION WITH LINKS & SOCIAL ICONS & COPYRIGHT ------- -->
    <!--   Core JS Files   -->
    <script src="~/assets/js/core/popper.min.js"></script>
    <script src="~/assets/js/core/bootstrap.min.js"></script>
    <script src="~/assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="~/assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = {
                damping: '0.5'
            }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="~/assets/js/argon-dashboard.min.js?v=2.0.4"></script>

    <!-- Para obtener nombre completo del api -->
    <script>
        function obtenerNombre() {
            var identificacion = document.getElementById('Identificacion').value;
            if (identificacion.trim() === "") {
                return;
            }

            // Consultar la API del receptor para obtener el nombre
            fetch(`https://apis.gometa.org/cedulas/${identificacion}`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.nombre) {
                        document.getElementById('Nombre').value = data.nombre;
                    }
                })
                .catch(error => {
                    console.error('Error al obtener el nombre:', error);
                });
        }
    </script>

    <!-- Esto se trato de poner en el layout , pero por alguna razon no funcionaba bien -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <!-- captura y envia el valor del captcha para poder validar -->
    <script>
        function onSubmit() {
            var response = grecaptcha.getResponse();
            document.getElementById('recaptchaValue').value = response;
            document.forms[0].submit();
        }
    </script>

</body>
